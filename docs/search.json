[{"path":"index.html","id":"about","chapter":"1 About","heading":"1 About","text":"技術ブログを始めました。\nとてもお世話になった「R」についてメインで書いていきます。2025.02.11 m-ari","code":""},{"path":"ggplot2でグラフを描く.html","id":"ggplot2でグラフを描く","chapter":"2 ggplot2でグラフを描く","heading":"2 ggplot2でグラフを描く","text":"","code":""},{"path":"ggplot2でグラフを描く.html","id":"使用するデータ","chapter":"2 ggplot2でグラフを描く","heading":"2.1 使用するデータ","text":"使用するデータは、Rのサンプルデータ「cars」。","code":"\nsummary(cars)##      speed           dist       \n##  Min.   : 4.0   Min.   :  2.00  \n##  1st Qu.:12.0   1st Qu.: 26.00  \n##  Median :15.0   Median : 36.00  \n##  Mean   :15.4   Mean   : 42.98  \n##  3rd Qu.:19.0   3rd Qu.: 56.00  \n##  Max.   :25.0   Max.   :120.00"},{"path":"ggplot2でグラフを描く.html","id":"package","chapter":"2 ggplot2でグラフを描く","heading":"2.2 Package","text":"Rでグラフを描くなら、「ggplot2」パッケージです。","code":"\nlibrary(ggplot2)"},{"path":"ggplot2でグラフを描く.html","id":"普通のグラフ","chapter":"2 ggplot2でグラフを描く","heading":"2.3 普通のグラフ","text":"RのDefaultでグラフを描くと下記のようになります。","code":"\nplot(cars)"},{"path":"ggplot2でグラフを描く.html","id":"ggplot2のグラフ","chapter":"2 ggplot2でグラフを描く","heading":"2.4 ggplot2のグラフ","text":"Rのggplot2でグラフを描くと下記のようになります。","code":"\n# colnames(cars)\nggplot(cars, aes(x=speed, y=dist)) +\n    geom_point(size=3)"},{"path":"ggplot2でグラフを描く.html","id":"少し装飾すると","chapter":"2 ggplot2でグラフを描く","heading":"2.5 少し装飾すると…","text":"","code":"\n# Windowsフォントを設定\nwindowsFonts(\"MEI\"=windowsFont(\"Meiryo\"))\n# colnames(cars)\nggplot(cars, aes(x=speed, y=dist)) + \n  geom_point(size=3, color=\"blue\") +\n  ggtitle(\"車のスピードと停止距離\") + \n  theme_minimal(base_size = 12, base_family = \"MEI\")"},{"path":"ggplot2でグラフを描く.html","id":"最後に","chapter":"2 ggplot2でグラフを描く","heading":"2.6 最後に","text":"グラフは楽しい！！","code":""},{"path":"plotlyでグラフを描く.html","id":"plotlyでグラフを描く","chapter":"3 plotlyでグラフを描く","heading":"3 plotlyでグラフを描く","text":"","code":""},{"path":"plotlyでグラフを描く.html","id":"使用するデータ-1","chapter":"3 plotlyでグラフを描く","heading":"3.1 使用するデータ","text":"使用するデータは、Rのサンプルデータ「airquality」にします。","code":"\nsummary(airquality)##      Ozone           Solar.R           Wind             Temp      \n##  Min.   :  1.00   Min.   :  7.0   Min.   : 1.700   Min.   :56.00  \n##  1st Qu.: 18.00   1st Qu.:115.8   1st Qu.: 7.400   1st Qu.:72.00  \n##  Median : 31.50   Median :205.0   Median : 9.700   Median :79.00  \n##  Mean   : 42.13   Mean   :185.9   Mean   : 9.958   Mean   :77.88  \n##  3rd Qu.: 63.25   3rd Qu.:258.8   3rd Qu.:11.500   3rd Qu.:85.00  \n##  Max.   :168.00   Max.   :334.0   Max.   :20.700   Max.   :97.00  \n##  NA's   :37       NA's   :7                                       \n##      Month            Day      \n##  Min.   :5.000   Min.   : 1.0  \n##  1st Qu.:6.000   1st Qu.: 8.0  \n##  Median :7.000   Median :16.0  \n##  Mean   :6.993   Mean   :15.8  \n##  3rd Qu.:8.000   3rd Qu.:23.0  \n##  Max.   :9.000   Max.   :31.0  \n## "},{"path":"plotlyでグラフを描く.html","id":"package-1","chapter":"3 plotlyでグラフを描く","heading":"3.2 Package","text":"触れるグラフを描くなら、「plotly」パッケージです。","code":"\nlibrary(plotly)"},{"path":"plotlyでグラフを描く.html","id":"plotlyのグラフ","chapter":"3 plotlyでグラフを描く","heading":"3.3 plotlyのグラフ","text":"plotlyでグラフを描くと下記のようになります。\nグラフがグリグリ動かせます♪","code":"\nplot_ly(airquality,\n        x=~Month, \n        y=~Temp, \n        z=~Ozone,\n        color=~Ozone, \n        mode= \"markers\",\n        size=8,    \n        type = \"scatter3d\") %>% \n  layout(title = \"airquality\")"},{"path":"plotlyでグラフを描く.html","id":"最後に-1","chapter":"3 plotlyでグラフを描く","heading":"3.4 最後に","text":"グラフって楽しい！！Plotlyすごい。","code":""},{"path":"leafletで地図を作成する.html","id":"leafletで地図を作成する","chapter":"4 leafletで地図を作成する","heading":"4 leafletで地図を作成する","text":"","code":""},{"path":"leafletで地図を作成する.html","id":"package-2","chapter":"4 leafletで地図を作成する","heading":"4.1 Package","text":"触れる地図を描くなら、Leafletですね。","code":"\nlibrary(leaflet)"},{"path":"leafletで地図を作成する.html","id":"地図に点","chapter":"4 leafletで地図を作成する","heading":"4.2 地図に点","text":"地図に点（マーカー）を配置します。","code":"\nleaflet() %>%\n  addTiles() %>%\n  addMarkers(lng=139.745461, lat=35.65856, popup=\"This is the Tokyo Tower.\")"},{"path":"leafletで地図を作成する.html","id":"最後に-2","chapter":"4 leafletで地図を作成する","heading":"4.3 最後に","text":"Leafletを紹介しましたが、GIS分析のところを詳しく書いていこうかな。","code":""},{"path":"osmdataでデータを抽出する.html","id":"osmdataでデータを抽出する","chapter":"5 osmdataでデータを抽出する","heading":"5 osmdataでデータを抽出する","text":"","code":""},{"path":"osmdataでデータを抽出する.html","id":"はじめに","chapter":"5 osmdataでデータを抽出する","heading":"5.1 はじめに","text":"osmdataは、open street mapのデータを抽出できるPackageです。\n簡易に分析するときなど、osmdataを使うのもありかなと…。","code":""},{"path":"osmdataでデータを抽出する.html","id":"package-3","chapter":"5 osmdataでデータを抽出する","heading":"5.2 Package","text":"osmdataです。GIS系のsfも使います。leafletはアウトプット用。","code":"\nlibrary(leaflet)\nlibrary(osmdata)\nlibrary(sf)"},{"path":"osmdataでデータを抽出する.html","id":"データを取得する範囲を決める","chapter":"5 osmdataでデータを抽出する","heading":"5.3 データを取得する範囲を決める","text":"まずは範囲を決めます。今回は、仙台市にします。\nこれは、仙台市がすっぽり入るBox範囲内を対象にしています。","code":"\nread_bb = getbb('sendai')\nprint(read_bb)##         min      max\n## x 140.46947 141.2603\n## y  38.05085  38.4547"},{"path":"osmdataでデータを抽出する.html","id":"レジャーをゲット","chapter":"5 osmdataでデータを抽出する","heading":"5.4 レジャーをゲット","text":"範囲内にあるレジャーなところを取得します。\nPC環境によりますが、データ取得には数分かかります。","code":"\nx = opq(bbox = read_bb) %>% \n  add_osm_feature(key = 'leisure') %>% \n  osmdata_sf()\n\n#polygonだけにする。\nx_sf = x$osm_polygon\nx_sf = subset(x_sf,!is.na(x_sf$name))\n\n#余計な列を除外。\nx_sf_disp = x_sf[,c(\"name\",\"geometry\")]\nprint(x_sf_disp)## Simple feature collection with 2356 features and 1 field\n## Geometry type: POLYGON\n## Dimension:     XY\n## Bounding box:  xmin: 140.5636 ymin: 38.05114 xmax: 141.2622 ymax: 38.45594\n## Geodetic CRS:  WGS 84\n## First 10 features:\n##                        name                       geometry\n## 38812192      榴岡3丁目公園 POLYGON ((140.8874 38.26092...\n## 60981058   田子二丁目北公園 POLYGON ((140.9592 38.28326...\n## 61578891      田子2丁目公園 POLYGON ((140.9612 38.28038...\n## 61885151     高砂二丁目緑地 POLYGON ((140.9682 38.27068...\n## 62123827         清水沼公園 POLYGON ((140.8977 38.26628...\n## 62214328 岩沼海浜緑地野球場 POLYGON ((140.9318 38.11777...\n## 68087809         宮千代公園 POLYGON ((140.9104 38.25429...\n## 72107597         福住町公園 POLYGON ((140.9526 38.2729,...\n## 72107601     扇町一丁目公園 POLYGON ((140.9417 38.27221...\n## 76739089     上田子２号公園 POLYGON ((140.963 38.28284,..."},{"path":"osmdataでデータを抽出する.html","id":"地図にプロット","chapter":"5 osmdataでデータを抽出する","heading":"5.5 地図にプロット","text":"レジャーなポリゴンを表示します。どこに行こうかな。","code":"\n#mapに表示する\nleaflet() %>% \n  addTiles() %>%\n  addPolygons(data= x_sf_disp, color = \"blue\", popup=~name)"},{"path":"osmdataでデータを抽出する.html","id":"最後に-3","chapter":"5 osmdataでデータを抽出する","heading":"5.6 最後に","text":"open street mapに感謝感謝。本当に助かります。","code":""},{"path":"wideなデータをlongにそして要約する.html","id":"wideなデータをlongにそして要約する","chapter":"6 wideなデータをLongに。そして要約する","heading":"6 wideなデータをLongに。そして要約する","text":"","code":""},{"path":"wideなデータをlongにそして要約する.html","id":"はじめに-1","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.1 はじめに","text":"人間は、Wideなデータのほうが理解しやすい。\n一方で、機械や計算には、Longなデータが扱いやすい。\nということで、今回は、WideなデータをLongに変換します。\nなお、以前は「Reshape」を使っていましたが、今は「tidyverse」の方が便利かも。\n今回はこちらを使用します。","code":""},{"path":"wideなデータをlongにそして要約する.html","id":"package-4","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.2 Package","text":"使用するのは、「dplyr」と「tidyverse」パッケージです。\nテーブル表示に「DT」も使います。","code":"\nlibrary(dplyr)\nlibrary(tidyverse)\nlibrary(DT) #for Table display"},{"path":"wideなデータをlongにそして要約する.html","id":"使用するデータ-2","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.3 使用するデータ","text":"使用するデータは、Rのサンプルデータ「WorldPhones」にします。\n扱いやすいように加工します。","code":"\nread_df = WorldPhones %>%\n  as.data.frame() %>%\n  rownames_to_column(\"Year\")\n\n#Table disp\ndatatable(read_df)"},{"path":"wideなデータをlongにそして要約する.html","id":"wideからlongに変換","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.4 WideからLongに変換","text":"pivot_longer()を使用してLongに変換します。","code":"\ndf_long = read_df %>% \n  pivot_longer(cols = -c(Year),names_to = \"area\", values_to = \"val\" )\n\n#Table disp\ndatatable(df_long)"},{"path":"wideなデータをlongにそして要約する.html","id":"要約する","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.5 要約する","text":"Longなデータは要約も簡単です。\n下記は、area毎にvalを各種要約しています。","code":"\ns_data = df_long %>% \n  group_by(area) %>% \n  summarise(\n    numOfRecord = n(),\n    mean_val = mean(val),\n    max_val = max(val),\n    min_val = min(val),\n    p_005 = quantile(val, probs = 0.05),\n    p_095 = quantile(val, probs = 0.95)\n  )\n\n#Table disp\ndatatable(s_data)"},{"path":"wideなデータをlongにそして要約する.html","id":"最後に-4","chapter":"6 wideなデータをLongに。そして要約する","heading":"6.6 最後に","text":"データ分析って楽しい！","code":""},{"path":"シーケンス図を描く.html","id":"シーケンス図を描く","chapter":"7 シーケンス図を描く","heading":"7 シーケンス図を描く","text":"","code":""},{"path":"シーケンス図を描く.html","id":"はじめに-2","chapter":"7 シーケンス図を描く","heading":"7.1 はじめに","text":"20年位前、こういう図はEXCELで描いていました。\nまぁ、いまでも時々使いますが、こういうのも再現可能に作成できるのは本当にうれしいです。","code":""},{"path":"シーケンス図を描く.html","id":"package-5","chapter":"7 シーケンス図を描く","heading":"7.2 Package","text":"使用するのは、「DiagrammeR」パッケージです。","code":"\nlibrary(DiagrammeR)"},{"path":"シーケンス図を描く.html","id":"シーケンス図を書く","chapter":"7 シーケンス図を描く","heading":"7.3 シーケンス図を書く","text":"こんな感じに、シーケンス図が出来上がります。ALTにも対応している。","code":"\n# Create a sequence diagram\nDiagrammeR(\"\nsequenceDiagram;\n   customer->>ticket seller: ask for a ticket;\n   ticket seller->>database: seats;\n   alt tickets available\n     database->>ticket seller: ok;\n     ticket seller->>customer: confirm;\n     customer->>ticket seller: ok;\n     ticket seller->>database: book a seat;\n     ticket seller->>printer: print a ticket;\n   else sold out\n     database->>ticket seller: none left;\n     ticket seller->>customer: sorry;\n   end\n\")"},{"path":"シーケンス図を描く.html","id":"シーケンス図を書く2","chapter":"7 シーケンス図を描く","heading":"7.4 シーケンス図を書く2","text":"こんなのもできる。","code":"\nDiagrammeR(\"\nsequenceDiagram;\n    participant Alice\n    participant Bob\n    Alice->>John: Hello John, how are you?\n    loop HealthCheck\n        John->>John: Fight against hypochondria\n    end\n    Note right of John: Rational thoughts <br/>prevail!\n    John-->>Alice: Great!\n    John->>Bob: How about you?\n    Bob-->>John: Jolly good!\n\")"},{"path":"シーケンス図を描く.html","id":"よく書くやつ","chapter":"7 シーケンス図を描く","heading":"7.5 よく書くやつ","text":"私の世界では、こんな図をよく書いていた。","code":"\nDiagrammeR(\"\nsequenceDiagram;\n    participant UE\n    participant eNB\n    UE->>eNB: rrcConnectionRequest\n    Note right of eNB: Admission Check\n    alt Admission OK\n     eNB->>UE: rrcConnectionSetup\n     UE->>eNB: rrcConnectionSetupComplete\n    else Admission NG\n     eNB->>UE: rrcConnectionReject\n   end\n\n\")"},{"path":"シーケンス図を描く.html","id":"リンク","chapter":"7 シーケンス図を描く","heading":"7.6 リンク","text":"Mermaid公式リンク\n[link] https://mermaid.js.org/syntax/sequenceDiagram.html","code":""},{"path":"シーケンス図を描く.html","id":"最後に-5","chapter":"7 シーケンス図を描く","heading":"7.7 最後に","text":"シーケンス図、まだ活躍するはず！！（しないかな…。）\nあと、Alice、Bobとくると、次は、Charlieであってほしいのは、職業病か。","code":""},{"path":"ggpairsで重回帰分析.html","id":"ggpairsで重回帰分析","chapter":"8 ggpairsで重回帰分析","heading":"8 ggpairsで重回帰分析","text":"","code":""},{"path":"ggpairsで重回帰分析.html","id":"はじめに-3","chapter":"8 ggpairsで重回帰分析","heading":"8.1 はじめに","text":"データ分析するときって、まずはデータがどんな感じなのかを理解することから始めますよね。そんな時の分析の紹介です。","code":""},{"path":"ggpairsで重回帰分析.html","id":"使用するデータ-3","chapter":"8 ggpairsで重回帰分析","heading":"8.2 使用するデータ","text":"使用するデータは、Rのサンプルデータ「iris」にします。","code":"\nsummary(iris)##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   \n##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  \n##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  \n##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  \n##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  \n##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  \n##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  \n##        Species  \n##  setosa    :50  \n##  versicolor:50  \n##  virginica :50  \n##                 \n##                 \n## "},{"path":"ggpairsで重回帰分析.html","id":"package-6","chapter":"8 ggpairsで重回帰分析","heading":"8.3 Package","text":"おすすめは、「GGally」です。\nそして、触れるグラフを描くなら、「plotly」パッケージです。","code":"\nlibrary(plotly)\nlibrary(GGally)"},{"path":"ggpairsで重回帰分析.html","id":"分析","chapter":"8 ggpairsで重回帰分析","heading":"8.4 分析","text":"ggpairs()で、サクッと分析。すごすぎる。","code":"\nggpairs(iris)"},{"path":"ggpairsで重回帰分析.html","id":"分析2","chapter":"8 ggpairsで重回帰分析","heading":"8.5 分析2","text":"もう少し見やすく装飾してみます。","code":"\np = ggpairs(iris,\n            title = \"iris\",\n            mapping = aes(color = Species, alpha = 0.2),\n            upper = list(continuous = wrap(\"cor\", size = 2.5)),\n            lower = list(continuous = wrap(\"points\", size=1))\n) + theme(text=element_text(size=9))\n\nggplotly(p)"},{"path":"ggpairsで重回帰分析.html","id":"最後に-6","chapter":"8 ggpairsで重回帰分析","heading":"8.6 最後に","text":"データ分析って楽しい！","code":""},{"path":"nwデータを可視化する.html","id":"nwデータを可視化する","chapter":"9 NWデータを可視化する","heading":"9 NWデータを可視化する","text":"","code":""},{"path":"nwデータを可視化する.html","id":"はじめに-4","chapter":"9 NWデータを可視化する","heading":"9.1 はじめに","text":"FromとToがあるデータ（AからBへValueを渡す。みたいなデータ）がある場合の可視化の例です。","code":""},{"path":"nwデータを可視化する.html","id":"使用するデータ-4","chapter":"9 NWデータを可視化する","heading":"9.2 使用するデータ","text":"今回はデータを作成します。","code":"\na_group = c(\"A\",\"B\",\"C\",\"D\",\"E\")\n\nnw_data = data.frame(\n  # id = seq(1:5),\n  \"From_ID\" = sample(a_group,5),\n  \"To_ID\"   = sample(a_group,5),\n  \"Value\"   = sample(1:10,5, replace=F)\n)\nhead(nw_data)##   From_ID To_ID Value\n## 1       B     E     4\n## 2       A     C     6\n## 3       E     B     7\n## 4       D     A     8\n## 5       C     D     5"},{"path":"nwデータを可視化する.html","id":"package-7","chapter":"9 NWデータを可視化する","heading":"9.3 Package","text":"おすすめは、「visNetwork」です。","code":"\nlibrary(visNetwork)"},{"path":"nwデータを可視化する.html","id":"nodeの作成","chapter":"9 NWデータを可視化する","heading":"9.4 Nodeの作成","text":"Nodeを作成します。","code":"\n#nodeデータの作成\nnodes = data.frame(\n  id = a_group,\n  label = a_group\n)\nhead(nodes)##   id label\n## 1  A     A\n## 2  B     B\n## 3  C     C\n## 4  D     D\n## 5  E     E"},{"path":"nwデータを可視化する.html","id":"edgesの作成","chapter":"9 NWデータを可視化する","heading":"9.5 edgesの作成","text":"edgesを作成します。","code":"\nedges = data.frame(\n  from = nw_data$From_ID,\n  to   = nw_data$To_ID,\n  label = as.character(nw_data$Value),\n  width = nw_data$Value/2,\n  color = \"darkgray\"\n)\nhead(edges)##   from to label width    color\n## 1    B  E     4   2.0 darkgray\n## 2    A  C     6   3.0 darkgray\n## 3    E  B     7   3.5 darkgray\n## 4    D  A     8   4.0 darkgray\n## 5    C  D     5   2.5 darkgray"},{"path":"nwデータを可視化する.html","id":"可視化する","chapter":"9 NWデータを可視化する","heading":"9.6 可視化する","text":"nodeとedgeが出来上がれば、可視化できます。グリグリ動きます。","code":"\nvisNetwork(nodes, edges) %>%\n  visEdges(arrows = 'to', length = 200)"},{"path":"nwデータを可視化する.html","id":"参考リンク","chapter":"9 NWデータを可視化する","heading":"9.7 参考リンク","text":"[link] https://datastorm-open.github.io/visNetwork/","code":""},{"path":"nwデータを可視化する.html","id":"最後に-7","chapter":"9 NWデータを可視化する","heading":"9.8 最後に","text":"ネットワークを可視化して、眺めてみる。","code":""},{"path":"ポリゴンにbufferを作成する.html","id":"ポリゴンにbufferを作成する","chapter":"10 ポリゴンにBufferを作成する","heading":"10 ポリゴンにBufferを作成する","text":"","code":""},{"path":"ポリゴンにbufferを作成する.html","id":"はじめに-5","chapter":"10 ポリゴンにBufferを作成する","heading":"10.1 はじめに","text":"GISにおける、ポリゴンの操作の１つ、バッファの作成について書きます。","code":""},{"path":"ポリゴンにbufferを作成する.html","id":"使用するデータ-5","chapter":"10 ポリゴンにBufferを作成する","heading":"10.2 使用するデータ","text":"ノースカロライナのシェープファイルを読み込み、このデータを使用します。\nこれは、「sf」パッケージについています。","code":"\n#ノースカロライナのシェープファイルを読み込み\ninput <- sf::read_sf(system.file(\"shape/nc.shp\", package = \"sf\"))\ninput## Simple feature collection with 100 features and 14 fields\n## Geometry type: MULTIPOLYGON\n## Dimension:     XY\n## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965\n## Geodetic CRS:  NAD27\n## # A tibble: 100 × 15\n##     AREA PERIMETER CNTY_ CNTY_ID NAME  FIPS  FIPSNO CRESS_ID BIR74 SID74 NWBIR74\n##    <dbl>     <dbl> <dbl>   <dbl> <chr> <chr>  <dbl>    <int> <dbl> <dbl>   <dbl>\n##  1 0.114      1.44  1825    1825 Ashe  37009  37009        5  1091     1      10\n##  2 0.061      1.23  1827    1827 Alle… 37005  37005        3   487     0      10\n##  3 0.143      1.63  1828    1828 Surry 37171  37171       86  3188     5     208\n##  4 0.07       2.97  1831    1831 Curr… 37053  37053       27   508     1     123\n##  5 0.153      2.21  1832    1832 Nort… 37131  37131       66  1421     9    1066\n##  6 0.097      1.67  1833    1833 Hert… 37091  37091       46  1452     7     954\n##  7 0.062      1.55  1834    1834 Camd… 37029  37029       15   286     0     115\n##  8 0.091      1.28  1835    1835 Gates 37073  37073       37   420     0     254\n##  9 0.118      1.42  1836    1836 Warr… 37185  37185       93   968     4     748\n## 10 0.124      1.43  1837    1837 Stok… 37169  37169       85  1612     1     160\n## # ℹ 90 more rows\n## # ℹ 4 more variables: BIR79 <dbl>, SID79 <dbl>, NWBIR79 <dbl>,\n## #   geometry <MULTIPOLYGON [°]>"},{"path":"ポリゴンにbufferを作成する.html","id":"package-8","chapter":"10 ポリゴンにBufferを作成する","heading":"10.3 Package","text":"おすすめは、「sf」です。\nまた、今回は、QGISのアルゴリズムで作成する方法も解説します。\nこちらは「qgisprocess」です。","code":"\nlibrary(qgisprocess) #QGIS Algorithm\nlibrary(dplyr)\nlibrary(sf) #GIS用\nlibrary(leaflet) #Map"},{"path":"ポリゴンにbufferを作成する.html","id":"入力データを可視化","chapter":"10 ポリゴンにBufferを作成する","heading":"10.4 入力データを可視化","text":"ノースカロライナを可視化します。","code":"\n#Leafletに出力するため、WGS84に変更する\ninput_disp = input %>% st_transform(crs=4326)\n\n#Leafletに出力\nleaflet() %>%\n  addTiles() %>%\n  addPolygons(data = input_disp, color=\"blue\")"},{"path":"ポリゴンにbufferを作成する.html","id":"sfで5kmのbufferを作成","chapter":"10 ポリゴンにBufferを作成する","heading":"10.5 sfで5kmのBufferを作成","text":"測地系（CRS）を設定して、st_union()で合成し、\nst_buffer()で、5000mのバッファを作成します。\n赤色の線で、Bufferしたポリゴンを表します。","code":"\n#meter bufferを作成するため、ノースカロライナのEPSGに変換(st_transform)する。\n#各州を結合(st_union)して、sfのBuffer作成する。\nsf_ret = input %>% st_transform(crs=26717) %>%\n  st_union() %>% st_as_sf() %>% \n  st_buffer(dist = 5000)\n\n#表示用にWGS84に直す\nb_sf = sf_ret %>% st_transform(crs=4326)\n\n#Leafletで表示\nleaflet() %>%\n  addTiles() %>%\n  addPolygons(data = input_disp, color=\"blue\") %>%\n  addPolylines(data = b_sf, weight=10,color=\"red\") %>%\n  addScaleBar(position = \"bottomleft\",scaleBarOptions(imperial = FALSE))"},{"path":"ポリゴンにbufferを作成する.html","id":"qgisの準備","chapter":"10 ポリゴンにBufferを作成する","heading":"10.6 QGISの準備","text":"RでQGIS algorithmを利用できるんです。これ、かなり使える気がする。\n以下で、QGISで使用できるアルゴリズムを探して使用します。\n今回は、「native:buffer」を使用します。","code":"\n#QGIS algorithmの情報\nqgis_search_algorithms(\"buffer\")## # A tibble: 11 × 5\n##    provider provider_title    group                algorithm     algorithm_title\n##    <chr>    <chr>             <chr>                <chr>         <chr>          \n##  1 gdal     GDAL              Vector geoprocessing gdal:bufferv… Buffer vectors \n##  2 gdal     GDAL              Vector geoprocessing gdal:oneside… One side buffer\n##  3 grass    GRASS             Raster (r.*)         grass:r.buff… r.buffer       \n##  4 grass    GRASS             Raster (r.*)         grass:r.buff… r.buffer.lowmem\n##  5 grass    GRASS             Vector (v.*)         grass:v.buff… v.buffer       \n##  6 native   QGIS (native c++) Vector geometry      native:buffer Buffer         \n##  7 native   QGIS (native c++) Vector geometry      native:buffe… Variable width…\n##  8 native   QGIS (native c++) Vector geometry      native:multi… Multi-ring buf…\n##  9 native   QGIS (native c++) Vector geometry      native:singl… Single sided b…\n## 10 native   QGIS (native c++) Vector geometry      native:taper… Tapered buffers\n## 11 native   QGIS (native c++) Vector geometry      native:wedge… Create wedge b…\nq_alg = \"native:buffer\"\nq_alg_arguments = qgis_get_argument_specs(q_alg)\nq_alg_arguments## # A tibble: 9 × 6\n##   name    description qgis_type default_value available_values acceptable_values\n##   <chr>   <chr>       <chr>     <list>        <list>           <list>           \n## 1 INPUT   Input layer source    <NULL>        <NULL>           <chr [1]>        \n## 2 DISTAN… Distance    distance  <int [1]>     <NULL>           <chr [3]>        \n## 3 SEGMEN… Segments    number    <int [1]>     <NULL>           <chr [3]>        \n## 4 END_CA… End cap st… enum      <int [1]>     <chr [3]>        <chr [2]>        \n## 5 JOIN_S… Join style  enum      <int [1]>     <chr [3]>        <chr [2]>        \n## 6 MITER_… Miter limit number    <int [1]>     <NULL>           <chr [3]>        \n## 7 DISSOL… Dissolve r… boolean   <lgl [1]>     <NULL>           <chr [4]>        \n## 8 SEPARA… Keep disjo… boolean   <lgl [1]>     <NULL>           <chr [4]>        \n## 9 OUTPUT  Buffered    sink      <NULL>        <NULL>           <chr [1]>"},{"path":"ポリゴンにbufferを作成する.html","id":"qgisで1kmのbufferを作成","chapter":"10 ポリゴンにBufferを作成する","heading":"10.7 QGISで1kmのBufferを作成","text":"測地系（CRS）を設定して、st_union()で合成し、\nQGIS Algorithm 「native:buffer」で、1000mのバッファを作成します。\n赤色の線で、Bufferしたポリゴンを表します。","code":"\n#meter bufferのため、ノースカロライナのEPSGに変換する。\ninput_a = input %>% \n  st_union() %>% st_as_sf() %>% \n  st_transform(crs=26717)\ninput_a## Simple feature collection with 1 feature and 0 fields\n## Geometry type: MULTIPOLYGON\n## Dimension:     XY\n## Bounding box:  xmin: 196586.7 ymin: 3751514 xmax: 1002247 ymax: 4057630\n## Projected CRS: NAD27 / UTM zone 17N\n##                                x\n## 1 MULTIPOLYGON (((949976.3 40...\n#QGISのBuffer処理(1000 meter)\nq_alg = \"native:buffer\"\nq_alg_ret = qgis_run_algorithm(q_alg,\n                               INPUT = input_a,\n                               DISTANCE = 1000\n)\n\n#各州を結合して、表示用にWGS84に直す\na_sf = st_as_sf(q_alg_ret) %>% st_transform(crs=4326)\n\n#Leafletで表示\nleaflet() %>%\n  addTiles() %>%\n  addPolygons(data = input_disp, color=\"blue\") %>%\n  addPolylines(data = b_sf, weight=10,color=\"red\") %>%\n  addPolylines(data = a_sf, weight=5,color=\"green\") %>%\n  addScaleBar(position = \"bottomleft\",scaleBarOptions(imperial = FALSE))"},{"path":"ポリゴンにbufferを作成する.html","id":"最後に-8","chapter":"10 ポリゴンにBufferを作成する","heading":"10.8 最後に","text":"sfは、RでGISるときの基本です。覚えるとめっちゃ便利です。\nまた、QGIS Algorithmを利用できるのは、もっと便利かもしれない。（勉強中なう。）\nボロノイについて勉強して記事を書く予定です。","code":""},{"path":"prophetで時系列データを分析する.html","id":"prophetで時系列データを分析する","chapter":"11 Prophetで時系列データを分析する","heading":"11 Prophetで時系列データを分析する","text":"","code":""},{"path":"prophetで時系列データを分析する.html","id":"はじめに-6","chapter":"11 Prophetで時系列データを分析する","heading":"11.1 はじめに","text":"時系列データの分析です。","code":""},{"path":"prophetで時系列データを分析する.html","id":"使用するデータ-6","chapter":"11 Prophetで時系列データを分析する","heading":"11.2 使用するデータ","text":"日本のコロナの陽性者数データを使用します。厚生労働省HP\n[link] https://www.mhlw.go.jp/stf/covid-19/open-data.html","code":"\nread_df = read.csv(\n  \"https://covid19.mhlw.go.jp/public/opendata/newly_confirmed_cases_daily.csv\"\n  )[,c(\"Date\",\"ALL\")]\n\nsummary(read_df)##      Date                ALL        \n##  Length:1209        Min.   :     0  \n##  Class :character   1st Qu.:   577  \n##  Mode  :character   Median :  3872  \n##                     Mean   : 27906  \n##                     3rd Qu.: 34608  \n##                     Max.   :261735"},{"path":"prophetで時系列データを分析する.html","id":"package-9","chapter":"11 Prophetで時系列データを分析する","heading":"11.3 Package","text":"おすすめは、「Prophet」です。\nARIMAとかSARIMAとかあるようですが、難しそうで…。","code":"\nlibrary(tidyverse)\nlibrary(prophet)"},{"path":"prophetで時系列データを分析する.html","id":"入力データの準備","chapter":"11 Prophetで時系列データを分析する","heading":"11.4 入力データの準備","text":"prophetで分析するために、列名を整えます。","code":"\n#change\nread_df$Date = as.Date(read_df$Date)\ncolnames(read_df) = c(\"ds\",\"y\")\n\nsummary(read_df)##        ds                   y         \n##  Min.   :2020-01-16   Min.   :     0  \n##  1st Qu.:2020-11-13   1st Qu.:   577  \n##  Median :2021-09-11   Median :  3872  \n##  Mean   :2021-09-11   Mean   : 27906  \n##  3rd Qu.:2022-07-10   3rd Qu.: 34608  \n##  Max.   :2023-05-08   Max.   :261735"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析モデルの作成","chapter":"11 Prophetで時系列データを分析する","heading":"11.5 prophet分析:モデルの作成","text":"prophetでは、まずモデルを作成します。\nパラメータは、適当に。","code":"\np_model = read_df %>% prophet(\n  growth = \"linear\",\n  # changepoints = NULL,\n  # n.changepoints = 25,\n  # changepoint.range = 0.8,\n  changepoint.prior.scale = 0.05,\n\n  seasonality.mode = \"multiplicative\",\n  seasonality.prior.scale = 10,\n  \n  yearly.seasonality = TRUE,\n  weekly.seasonality = TRUE,\n  daily.seasonality  = FALSE,\n  \n  holidays = NULL,\n  holidays.prior.scale = 10\n)"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析将来の定義","chapter":"11 Prophetで時系列データを分析する","heading":"11.6 prophet分析:将来の定義","text":"将来を定義します。ここでは７日間にしました。","code":"\nfuture <- make_future_dataframe(p_model, periods = 7)"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析モデルから将来を予測","chapter":"11 Prophetで時系列データを分析する","heading":"11.7 prophet分析:モデルから将来を予測","text":"そして予測します。","code":"\nforecast <- predict(p_model, future)\ntail(forecast[c('ds', 'yhat', 'yhat_lower', 'yhat_upper')])##              ds        yhat yhat_lower yhat_upper\n## 1211 2023-05-10 -13476.4390  -29724.48   3323.992\n## 1212 2023-05-11 -12683.1817  -29270.36   5108.595\n## 1213 2023-05-12 -11075.8321  -27374.41   5324.876\n## 1214 2023-05-13 -11155.8936  -28334.14   5261.387\n## 1215 2023-05-14  -8438.3443  -25638.64   8506.165\n## 1216 2023-05-15   -502.3431  -17641.19  17708.142"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析結果を出力１","chapter":"11 Prophetで時系列データを分析する","heading":"11.8 prophet分析:結果を出力１","text":"dygraphで簡単に出力までできます。","code":"\ndyplot.prophet(p_model, forecast)"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析結果を出力２","chapter":"11 Prophetで時系列データを分析する","heading":"11.9 prophet分析:結果を出力２","text":"季節性とか、これで確認もできます。\n８月と１月が増えるトレンドとか…。月曜日が減るトレンドとか…。\nで、理由（因果）を考える感じになりますよね。","code":"\nprophet_plot_components(p_model, forecast)"},{"path":"prophetで時系列データを分析する.html","id":"prophet分析パラメータの調整","chapter":"11 Prophetで時系列データを分析する","heading":"11.10 prophet分析:パラメータの調整","text":"もう少し、データにフィットさせるには、パラメータを調整します。\nchangepoint.prior.scaleを0.02に変更してみます。\nうーーん、2022年あたりが微妙…。\n結局、ここらへんのパラメータを変更するって微妙な気がする。","code":"\np_model = read_df %>% prophet(\n  growth = \"linear\",\n  changepoint.prior.scale = 0.02,\n\n  seasonality.mode = \"multiplicative\",\n  seasonality.prior.scale = 10,\n  \n  yearly.seasonality = TRUE,\n  weekly.seasonality = TRUE,\n  daily.seasonality  = FALSE,\n  \n  holidays = NULL,\n  holidays.prior.scale = 10\n)\n\nfuture = make_future_dataframe(p_model, periods = 7)\nforecast = predict(p_model, future)\ndyplot.prophet(p_model, forecast)"},{"path":"prophetで時系列データを分析する.html","id":"最後に-9","chapter":"11 Prophetで時系列データを分析する","heading":"11.11 最後に","text":"簡単に将来を予測というか、簡単にモデルが作れるのがprophetのいいところですね。\n線形予測より説得力があるように見えますよね。","code":""}]
